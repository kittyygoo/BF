<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Эксперимент с лотерейными баллами</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            --bg-main: #f3f4f6;
            --bg-header: #ffffff;
            --card-bg: #ffffff;
            --card-border: #e5e7eb;

            --primary: #0d9488;        /* бирюзовый */
            --primary-soft: #ccfbf1;
            --primary-dark: #0f766e;
            --accent: #6366f1;

            --text-main: #111827;
            --text-muted: #6b7280;
            --danger: #dc2626;

            --radius-lg: 16px;
            --radius-pill: 999px;

            --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.06);
            --border-soft: #d1d5db;
            --transition-fast: 150ms ease-out;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background:
                radial-gradient(circle at top left, #e0f2fe 0, transparent 45%),
                radial-gradient(circle at bottom right, #fef9c3 0, transparent 50%),
                var(--bg-main);
            color: var(--text-main);
        }

        .app-root {
            max-width: 980px;
            margin: 0 auto;
            padding: 24px 16px 40px;
        }

        /* Хедер с балансом */
        header.balance-header {
            position: sticky;
            top: 0;
            z-index: 10;
            margin: -24px -16px 24px;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(209, 213, 219, 0.9);
            backdrop-filter: blur(10px);
        }

        .balance-inner {
            max-width: 980px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .balance-title {
            font-size: 13px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .balance-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: var(--radius-pill);
            background: linear-gradient(90deg, #14b8a6, #22c55e);
            color: #ffffff;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 8px 25px rgba(13, 148, 136, 0.35);
        }

        /* Карточка */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 22px 22px 20px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--card-border);
            margin-bottom: 20px;
        }

        h1, h2, h3 {
            margin-top: 0;
            letter-spacing: 0.01em;
        }

        h1 { font-size: 24px; margin-bottom: 10px; }
        h2 { font-size: 20px; margin-bottom: 12px; }
        h3 { font-size: 16px; margin-bottom: 8px; }

        p { margin: 0 0 10px; }

        .highlight {
            color: var(--primary-dark);
            font-weight: 500;
        }

        .prize-amount {
            font-weight: 700;
            color: #b91c1c;
        }

        .field-group {
            margin-bottom: 18px;
        }

        .field-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .radio-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: var(--radius-pill);
            border: 1px solid var(--border-soft);
            background: #f9fafb;
            font-size: 14px;
            cursor: pointer;
            transition:
                background var(--transition-fast),
                border-color var(--transition-fast),
                box-shadow var(--transition-fast),
                transform var(--transition-fast);
        }

        .radio-pill input {
            accent-color: var(--primary);
        }

        .radio-pill:hover {
            background: #ecfeff;
            border-color: #67e8f9;
            box-shadow: 0 0 0 1px rgba(45, 212, 191, 0.45);
            transform: translateY(-1px);
        }

        select, input[type="text"] {
            width: 100%;
            max-width: 320px;
            padding: 8px 12px;
            border-radius: var(--radius-pill);
            border: 1px solid var(--border-soft);
            background: #f9fafb;
            color: var(--text-main);
            font-size: 14px;
            outline: none;
            transition:
                border-color var(--transition-fast),
                box-shadow var(--transition-fast),
                background var(--transition-fast);
        }

        select:focus, input[type="text"]:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 1px rgba(13, 148, 136, 0.5);
            background: #ffffff;
        }

        input::placeholder {
            color: #9ca3af;
        }

        button {
            font-family: inherit;
        }

        button.primary {
            background: linear-gradient(90deg, var(--primary), var(--accent));
            color: #ffffff;
            border: none;
            border-radius: var(--radius-pill);
            padding: 9px 20px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 600;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 16px 35px rgba(99, 102, 241, 0.35);
            transition:
                transform var(--transition-fast),
                box-shadow var(--transition-fast),
                opacity var(--transition-fast),
                filter var(--transition-fast);
        }

        button.primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 22px 50px rgba(99, 102, 241, 0.45);
            filter: brightness(1.03);
        }

        button.primary:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 12px 30px rgba(99, 102, 241, 0.4);
        }

        button.primary:disabled {
            opacity: 0.7;
            box-shadow: none;
            cursor: default;
        }

        button.secondary {
            background: #f9fafb;
            color: var(--text-muted);
            border-radius: var(--radius-pill);
            border: 1px solid var(--border-soft);
            padding: 7px 16px;
            font-size: 13px;
            cursor: pointer;
            transition:
                background var(--transition-fast),
                color var(--transition-fast),
                border-color var(--transition-fast),
                transform var(--transition-fast),
                box-shadow var(--transition-fast);
        }

        button.secondary:hover:not(:disabled) {
            background: #e5f3ff;
            border-color: #bfdbfe;
            color: #111827;
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.12);
        }

        .question-options {
            margin-top: 12px;
            margin-bottom: 16px;
        }

        .question-options .radio-group {
            flex-direction: column;
            gap: 8px;
        }

        .progress-text {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .question-meta {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .small-note {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
        }

        .footer-buttons {
            margin-top: 18px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Прогресс-бар */
        .progress-bar-wrapper {
            width: 100%;
            background: #e5e7eb;
            border-radius: var(--radius-pill);
            overflow: hidden;
            height: 6px;
            margin-bottom: 14px;
            border: 1px solid #d1d5db;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 200ms ease-out;
        }

        .attention-box {
            border-radius: 12px;
            border: 1px solid rgba(250, 204, 21, 0.8);
            background: #fef9c3;
            padding: 8px 10px;
            font-size: 13px;
            color: #854d0e;
            margin-bottom: 10px;
        }

        .status-text {
            font-size: 13px;
            margin-top: 8px;
        }

        .status-success {
            color: #16a34a;
        }

        .status-error {
            color: var(--danger);
        }

        @media (max-width: 640px) {
            header.balance-header {
                padding-inline: 12px;
            }
            .balance-inner {
                flex-direction: column;
                align-items: flex-start;
            }
            .card {
                padding: 18px 16px 18px;
            }
        }
    </style>
</head>
<body>
<div id="root" class="app-root"></div>

<!-- React + ReactDOM + Babel -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<script type="text/babel" data-presets="es2015,react">
const { useState, useEffect } = React;

const QUESTION_TYPE_RISK = "risk";
const QUESTION_TYPE_COMPREHENSION = "comprehension";

function describeOutcome(amount) {
    if (amount > 0) {
        return "получить " + amount + " баллов";
    }
    if (amount < 0) {
        return "потерять " + Math.abs(amount) + " баллов";
    }
    return "не изменить баланс";
}

/* Вопросы из файла (блоки 1–3) */
const EXPERIMENT_QUESTIONS = [
    // Блок 1
    {
        id: "B1_Q1",
        block: 1,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 1.1",
        guaranteed: { amount: 6 },
        risky: { probability: 0.5, outcomeIfSuccess: 12, outcomeIfFailure: 0 }
    },
    {
        id: "B1_Q2",
        block: 1,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 1.2",
        guaranteed: { amount: 8 },
        risky: { probability: 0.4, outcomeIfSuccess: 20, outcomeIfFailure: -4 }
    },
    {
        id: "B1_Q3",
        block: 1,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 1.3",
        guaranteed: { amount: 10 },
        risky: { probability: 0.25, outcomeIfSuccess: 40, outcomeIfFailure: 0 }
    },
    {
        id: "B1_Q4",
        block: 1,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 1.4",
        guaranteed: { amount: 4 },
        risky: { probability: 0.2, outcomeIfSuccess: 20, outcomeIfFailure: 0 }
    },
    {
        id: "B1_Q5",
        block: 1,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 1.5",
        guaranteed: { amount: 12 },
        risky: { probability: 0.3, outcomeIfSuccess: 40, outcomeIfFailure: -6 }
    },

    // Блок 2 — comprehension
    {
        id: "B2_COMPREHENSION",
        block: 2,
        type: QUESTION_TYPE_COMPREHENSION,
        title: "Вопрос 2.0",
        text: "Представьте, что участник A получил 10 баллов, а участник B — 20 баллов. Какое утверждение верно?",
        options: [
            { value: "same", label: "Оба участника имеют одинаковый шанс выиграть приз" },
            { value: "a_wins", label: "Участник A гарантированно выигрывает приз" },
            { value: "b_higher", label: "У участника B выше шанс выиграть приз, чем у участника A" },
            { value: "no_influence", label: "Количество баллов не влияет на шанс выиграть" }
        ]
    },

    // Блок 2 — рискованные
    {
        id: "B2_Q1",
        block: 2,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 2.1",
        guaranteed: { amount: 5 },
        risky: { probability: 0.3, outcomeIfSuccess: 20, outcomeIfFailure: 0 }
    },
    {
        id: "B2_Q2",
        block: 2,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 2.2",
        guaranteed: { amount: 10 },
        risky: { probability: 0.2, outcomeIfSuccess: 60, outcomeIfFailure: -5 }
    },
    {
        id: "B2_Q3",
        block: 2,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 2.3",
        guaranteed: { amount: 7 },
        risky: { probability: 0.4, outcomeIfSuccess: 20, outcomeIfFailure: 0 }
    },
    {
        id: "B2_Q4",
        block: 2,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 2.4",
        guaranteed: { amount: 8 },
        risky: { probability: 0.25, outcomeIfSuccess: 40, outcomeIfFailure: 0 }
    },
    {
        id: "B2_Q5",
        block: 2,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 2.5",
        guaranteed: { amount: 6 },
        risky: { probability: 0.5, outcomeIfSuccess: 15, outcomeIfFailure: -1 }
    },

    // Блок 3
    {
        id: "B3_Q1",
        block: 3,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 3.1",
        guaranteed: { amount: 12 },
        risky: { probability: 0.3, outcomeIfSuccess: 20, outcomeIfFailure: 0 }
    },
    {
        id: "B3_Q2",
        block: 3,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 3.2",
        guaranteed: { amount: 7 },
        risky: { probability: 0.1, outcomeIfSuccess: 60, outcomeIfFailure: -4 }
    },
    {
        id: "B3_Q3",
        block: 3,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 3.3",
        guaranteed: { amount: 10 },
        risky: { probability: 0.2, outcomeIfSuccess: 30, outcomeIfFailure: -3 }
    },
    {
        id: "B3_Q4",
        block: 3,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 3.4",
        guaranteed: { amount: 15 },
        risky: { probability: 0.25, outcomeIfSuccess: 40, outcomeIfFailure: 0 }
    },
    {
        id: "B3_Q5",
        block: 3,
        type: QUESTION_TYPE_RISK,
        title: "Вопрос 3.5",
        guaranteed: { amount: 9 },
        risky: { probability: 0.1, outcomeIfSuccess: 60, outcomeIfFailure: -7 }
    }
];

const TOTAL_QUESTIONS = EXPERIMENT_QUESTIONS.length;

function generateUUID() {
    if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
    return "xxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
        const r = (Math.random() * 16) | 0;
        const v = c === "x" ? r : (r & 0x3) | 0x8;
        return v.toString(16);
    });
}

function App() {
    const [step, setStep] = useState("intro"); // intro | questions | finish
    const [respondentId, setRespondentId] = useState(null);
    const [gender, setGender] = useState("");
    const [age, setAge] = useState("");
    const [currentPoints, setCurrentPoints] = useState(0);

    const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
    const [currentChoice, setCurrentChoice] = useState(null);

    const [answers, setAnswers] = useState([]);
    const [finalPoints, setFinalPoints] = useState(0);

    const [contact, setContact] = useState("");
    const [contactSent, setContactSent] = useState(false);
    const [sendError, setSendError] = useState(null);
    const [isSending, setIsSending] = useState(false);

    useEffect(function () {
        setRespondentId(generateUUID());
    }, []);

    const canStart = gender !== "" && age !== "";

    function handleStart() {
        setCurrentPoints(0);
        setCurrentQuestionIndex(0);
        setCurrentChoice(null);
        setAnswers([]);
        setFinalPoints(0);
        setStep("questions");
    }

    function handleQuestionSubmit() {
        const question = EXPERIMENT_QUESTIONS[currentQuestionIndex];
        if (!question || !currentChoice) return;

        let newPoints = currentPoints;
        let delta = 0;
        let riskOutcome = "n/a";
        let riskChosen = null;

        if (question.type === QUESTION_TYPE_COMPREHENSION) {
            delta = 0;
            riskOutcome = "n/a";
            riskChosen = null;
        } else if (question.type === QUESTION_TYPE_RISK) {
            if (currentChoice === "A") {
                delta = question.guaranteed.amount;
                newPoints = currentPoints + delta;
                riskOutcome = "n/a";
                riskChosen = false;
            } else if (currentChoice === "B") {
                const p = question.risky.probability;
                const a1 = question.risky.outcomeIfSuccess;
                const a2 = question.risky.outcomeIfFailure;
                const success = Math.random() < p;
                delta = success ? a1 : a2;
                newPoints = currentPoints + delta;

                const betterAmount = Math.max(a1, a2);
                riskOutcome = (delta === betterAmount) ? "win" : "lose";
                riskChosen = true;
            }
        }

        const answerRecord = {
            respondentId: respondentId,
            questionIndex: currentQuestionIndex,
            questionId: question.id,
            block: question.block,
            type: question.type,
            choice: currentChoice,
            riskChosen: riskChosen,
            riskOutcome: riskOutcome,
            delta: delta,
            pointsAfter: newPoints,
            timestamp: new Date().toISOString()
        };

        const updatedAnswers = answers.slice();
        updatedAnswers[currentQuestionIndex] = answerRecord;
        setAnswers(updatedAnswers);

        if (question.type === QUESTION_TYPE_RISK) {
            setCurrentPoints(newPoints);
        }

        if (currentQuestionIndex + 1 < TOTAL_QUESTIONS) {
            setCurrentQuestionIndex(currentQuestionIndex + 1);
            setCurrentChoice(null);
        } else {
            setFinalPoints(newPoints);
            setStep("finish");
        }
    }

    function handleRestart() {
        setRespondentId(generateUUID());
        setGender("");
        setAge("");
        setCurrentPoints(0);
        setCurrentQuestionIndex(0);
        setCurrentChoice(null);
        setAnswers([]);
        setFinalPoints(0);
        setContact("");
        setContactSent(false);
        setSendError(null);
        setIsSending(false);
        setStep("intro");
    }

    function handleSubmitContact() {
        const trimmed = contact ? contact.trim() : "";
        if (!trimmed || contactSent || isSending) return;

        setIsSending(true);
        setSendError(null);

        const payload = {
            respondentId: respondentId,
            gender: gender,
            age: age,
            totalPoints: finalPoints,
            contact: trimmed,
            answers: answers
        };

        fetch("https://script.google.com/macros/s/AKfycbx3BhCT31fYQmDAqLi4JTKJHHNfR_BTsAcPi5Jaou8tAFiyUeGtlmMkjT_zjmtxWwV1/exec", {
            method: "POST",
            headers: {
                "Content-Type": "text/plain;charset=utf-8"
            },
            body: JSON.stringify(payload)
        })
            .then(function () {
                setContactSent(true);
                setIsSending(false);
            })
            .catch(function (err) {
                console.error("Ошибка отправки в Google Apps Script", err);
                setSendError("Не удалось отправить данные. Попробуйте ещё раз или свяжитесь с организатором.");
                setIsSending(false);
            });
    }

    const currentQuestion = step === "questions"
        ? EXPERIMENT_QUESTIONS[currentQuestionIndex]
        : null;

    const balanceLabel = currentPoints === 0
        ? "0"
        : (currentPoints > 0 ? ("+" + currentPoints) : String(currentPoints));

    const progressPercent = step === "questions"
        ? ((currentQuestionIndex + 1) / TOTAL_QUESTIONS) * 100
        : (step === "finish" ? 100 : 0);

    return (
        <React.Fragment>
            <header className="balance-header">
                <div className="balance-inner">
                    <div>
                        <div className="balance-title">Лотерейный баланс</div>
                        <div className="balance-pill">
                            <span>{balanceLabel} баллов</span>
                        </div>
                    </div>
                </div>
            </header>

            <main>
                {step === "intro" && (
                    <section className="card">
                        <h1>Эксперимент с лотерейными баллами</h1>
                        <p>
                            В этом исследовании вы будете выбирать между
                            гарантированными и рискованными вариантами, которые
                            приносят <span className="highlight">лотерейные баллы</span>.
                        </p>
                        <p>
                            В конце будет проведён розыгрыш, и участник, чьи баллы
                            будут наибольшими, получит приз&nbsp;
                            <span className="prize-amount">2000&nbsp;₽</span>.
                        </p>
                        <p style={{ marginBottom: 14 }}>
                            Чем больше баллов вы наберёте, тем выше шанс выиграть приз.
                            Пожалуйста, отвечайте так, как вы бы делали это в реальной жизни.
                        </p>

                        <div className="field-group">
                            <div className="field-label">Пол</div>
                            <div className="radio-group">
                                <label className="radio-pill">
                                    <input
                                        type="radio"
                                        name="gender"
                                        value="M"
                                        checked={gender === "M"}
                                        onChange={function () { setGender("M"); }}
                                    />
                                    <span>М</span>
                                </label>
                                <label className="radio-pill">
                                    <input
                                        type="radio"
                                        name="gender"
                                        value="F"
                                        checked={gender === "F"}
                                        onChange={function () { setGender("F"); }}
                                    />
                                    <span>Ж</span>
                                </label>
                            </div>
                        </div>

                        <div className="field-group">
                            <div className="field-label">Возраст</div>
                            <select
                                value={age}
                                onChange={function (e) { setAge(e.target.value); }}
                            >
                                <option value="" disabled>Выберите возрастную группу</option>
                                <option value="18-24">18–24</option>
                                <option value="25-34">25–34</option>
                                <option value="35-44">35–44</option>
                                <option value="45-54">45–54</option>
                                <option value="55-64">55–64</option>
                                <option value="65+">65+</option>
                            </select>
                        </div>

                        <button
                            className="primary"
                            disabled={!canStart}
                            onClick={handleStart}
                        >
                            Начать эксперимент
                        </button>

                        <p className="small-note">
                            Участие анонимно. В конце вы сможете оставить контакт
                            для связи в случае выигрыша.
                        </p>
                    </section>
                )}

                {step === "questions" && currentQuestion && (
                    <section className="card">
                        <div className="progress-text">
                            Вопрос {currentQuestionIndex + 1} из {TOTAL_QUESTIONS}
                        </div>
                        <div className="progress-bar-wrapper">
                            <div
                                className="progress-bar-fill"
                                style={{ width: progressPercent + "%" }}
                            />
                        </div>
                        <div className="question-meta">
                            Блок {currentQuestion.block}
                            {currentQuestion.type === QUESTION_TYPE_COMPREHENSION
                                ? " · проверка понимания лотереи"
                                : ""}
                        </div>

                        <h2>{currentQuestion.title}</h2>

                        {currentQuestion.type === QUESTION_TYPE_COMPREHENSION ? (
                            <React.Fragment>
                                <p>{currentQuestion.text}</p>
                                <div className="question-options">
                                    <div className="radio-group">
                                        {currentQuestion.options.map(function (opt) {
                                            return (
                                                <label key={opt.value} className="radio-pill">
                                                    <input
                                                        type="radio"
                                                        name={"q_" + currentQuestion.id}
                                                        value={opt.value}
                                                        checked={currentChoice === opt.value}
                                                        onChange={function () { setCurrentChoice(opt.value); }}
                                                    />
                                                    <span>{opt.label}</span>
                                                </label>
                                            );
                                        })}
                                    </div>
                                </div>
                            </React.Fragment>
                        ) : (
                            <React.Fragment>
                                <p>Пожалуйста, выберите один из двух вариантов:</p>
                                <div className="question-options">
                                    <div className="radio-group">
                                        <label className="radio-pill" style={{ width: "100%" }}>
                                            <input
                                                type="radio"
                                                name={"q_" + currentQuestion.id}
                                                value="A"
                                                checked={currentChoice === "A"}
                                                onChange={function () { setCurrentChoice("A"); }}
                                            />
                                            <span>
                                                <strong>Вариант A:</strong>{" "}
                                                {currentQuestion.guaranteed.amount >= 0
                                                    ? (currentQuestion.guaranteed.amount + " баллов гарантировано")
                                                    : ("гарантированная потеря " + Math.abs(currentQuestion.guaranteed.amount) + " баллов")}
                                            </span>
                                        </label>
                                        <label className="radio-pill" style={{ width: "100%" }}>
                                            <input
                                                type="radio"
                                                name={"q_" + currentQuestion.id}
                                                value="B"
                                                checked={currentChoice === "B"}
                                                onChange={function () { setCurrentChoice("B"); }}
                                            />
                                            <span>
                                                <strong>Вариант B:</strong>{" "}
                                                {Math.round(currentQuestion.risky.probability * 100)}% шанс{" "}
                                                {describeOutcome(currentQuestion.risky.outcomeIfSuccess)};{" "}
                                                {Math.round((1 - currentQuestion.risky.probability) * 100)}% шанс{" "}
                                                {describeOutcome(currentQuestion.risky.outcomeIfFailure)}
                                            </span>
                                        </label>
                                    </div>
                                </div>
                            </React.Fragment>
                        )}

                        <button
                            className="primary"
                            disabled={!currentChoice}
                            onClick={handleQuestionSubmit}
                        >
                            Подтвердить выбор
                        </button>
                    </section>
                )}

                {step === "finish" && (
                    <section className="card">
                        <h2>Эксперимент завершён</h2>
                        <p>
                            Вы набрали:&nbsp;
                            <span className="prize-amount">{finalPoints} лотерейных баллов</span>.
                        </p>
                        <p>
                            Каждый результат по баллам — это один «билет» в розыгрыше приза
                            <span className="prize-amount"> 2000&nbsp;₽</span>.
                        </p>
                        <p style={{ marginTop: 12 }}>
                            Если вы хотите участвовать в розыгрыше, пожалуйста,
                            оставьте контакт для связи в случае выигрыша.
                        </p>

                        <div className="field-group" style={{ marginTop: 14 }}>
                            <div className="field-label">
                                Ваш Telegram или другой удобный способ связи
                            </div>
                            <input
                                type="text"
                                value={contact}
                                onChange={function (e) { setContact(e.target.value); }}
                                placeholder="@username, телефон, почта и т.п."
                                disabled={contactSent}
                            />
                        </div>

                        <div className="footer-buttons">
                            <button
                                className="primary"
                                onClick={handleSubmitContact}
                                disabled={contactSent || isSending || !(contact && contact.trim())}
                            >
                                {contactSent ? "Контакт сохранён" : "Отправить контакт и завершить"}
                            </button>
                            <button
                                className="secondary"
                                onClick={handleRestart}
                            >
                                Пройти ещё раз
                            </button>
                        </div>

                        {contactSent && (
                            <div className="status-text status-success">
                                Спасибо! Данные сохранены, с победителем свяжутся по указанному контакту.
                            </div>
                        )}
                        {sendError && (
                            <div className="status-text status-error">
                                {sendError}
                            </div>
                        )}
                        {!contactSent && !sendError && (
                            <p className="small-note">
                                Контакт используется только для уведомления в случае выигрыша.
                                Ответы анализируются анонимно.
                            </p>
                        )}
                    </section>
                )}
            </main>
        </React.Fragment>
    );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
</script>
</body>
</html>